import{U as r}from"./uikit.d2d6e93b.js";import"./vendor.41c6d5da.js";function v(e,o){return e.parentElement.querySelector(o)?e:v(e.parentElement,o)}let f={};class _{constructor(o){!o||(typeof o=="string"?this.element=document.querySelectorAll(o):o instanceof NodeList?this.element=o:this.element=[o])}removeAll(){this.element.forEach(o=>{o.remove()})}on(o,t,n){this.element.forEach(i=>{f[i]=t,i.addEventListener(o,t,n)})}off(o){this.element.forEach(t=>{t.removeEventListener(o,f[t])})}parents(o){return this.element=[v(this.element[0],o)],this}data(o,t){return this.element.forEach(n=>{t&&t(n.getAttribute(o))}),this}before(o){this.element.forEach(t=>{t.before(o)})}index(){if(this.element[0]&&this.element[0].parentElement){for(let o=0;o<this.element[0].parentElement.children.length;o++)if(this.element[0].parentElement.children[o]==this.element[0])return o}return-1}}const d=function(e){return new _(e)};let a=0,u=p(a);function p(e){const o=localStorage.getItem("order"+e);return o?new Set(JSON.parse(o)):new Set}function g(){localStorage.setItem("order"+a,JSON.stringify([...u]))}function q(e){const o=localStorage.getItem(e);return o?JSON.parse(o):void 0}function x(){return[...p(a)]}function w(e){e.vegid="vid"+new Date().getTime(),localStorage.setItem(e.vegid,JSON.stringify(e)),u.add(e.vegid),g()}function T(e){localStorage.removeItem(e),u.delete(e),g()}function k(e){a=e,u=p(e)}function I(){u.forEach(e=>{localStorage.removeItem(e)}),u=new Set,g()}function b(e){localStorage.setItem("totalPrice",e)}var l={add:w,remove:T,changeOrder:k,clearAll:I,getGoodsInfo:q,getGoodsIds:x,updateTotalPrice:b};function A(){l.clearAll(),d("table>tbody>tr").removeAll(),s()}function s(){let e=0;UIkit.util.$$("table tbody tr").forEach(o=>{let t=JSON.parse(UIkit.util.data(o,"info"));e+=parseFloat(t.total_price)}),e=e.toFixed(2),UIkit.util.html("#totalPrice",document.createTextNode(e)),l.updateTotalPrice(e)}function y(e){let o=document.createElement("tr"),t=document.createElement("td");t.appendChild(document.createTextNode(e.veg_name)),o.appendChild(t),t=document.createElement("td"),t.appendChild(document.createTextNode(e.veg_weight)),o.appendChild(t),t=document.createElement("td"),t.appendChild(document.createTextNode(e.veg_price)),o.appendChild(t),t=document.createElement("td"),t.appendChild(document.createTextNode(e.total_price)),o.appendChild(t),t=document.createElement("td");let n=document.createElement("a");n.className="uk-icon-button uk-icon",t.appendChild(n),UIkit.icon(n,{icon:"close"}),o.appendChild(t),o.setAttribute("info",JSON.stringify(e)),o.setAttribute("vegid",e.vegid),r.util.prepend("table>tbody",o)}function N(e){l.add(e),y(e)}function S(){d("table>tbody>tr").removeAll(),l.getGoodsIds().forEach(o=>{y(l.getGoodsInfo(o))}),s()}var E={init(){S(),r.util.on("#orderMenu","show",e=>{console.log(e)}),r.util.on("table","click",e=>{(e.target.tagName=="svg"||e.target.tagName=="path"||e.target.tagName=="A")&&(d(e.target).parents("tr").data("vegid",o=>{l.remove(o)}).removeAll(),s())}),r.util.on("#orderMenu li","click",e=>{l.changeOrder(d(e.currentTarget).index()),S()})}};function $(e){O(e)}function W(){return(Math.random()*10+.5).toFixed(2)}setInterval(()=>$((Math.random()*10+.5).toFixed(2)),1e3);function m(){const e=document.querySelector("#price-editer").getAttribute("info");return e?JSON.parse(e):null}function h(e){document.querySelector("#price-editer").setAttribute("info",JSON.stringify(e))}function O(e){if(document.querySelector("#veg_weight").innerText!=e&&r.util.data(r.util.$$("#goodsInfo"),"isOpen")==1){document.querySelector("#veg_weight").innerText=e;const t=m();t&&t.type!=2&&(t.veg_weight=parseFloat(e),t.total_price=(t.veg_price*t.veg_weight).toFixed(2),document.querySelector("#total_price").innerText=t.total_price,h(t))}}var F={init(){r.util.on("#goodsInfo #okBtn","click",function(t){if(r.util.data(r.util.$$("#goodsInfo"),"isOpen")==1){const n=m();n&&(n.veg_price=parseFloat(document.querySelector("#veg_price").innerText),n.type==2?n.veg_weight=parseInt(document.querySelector("#count").value):n.veg_weight=parseFloat(document.querySelector("#veg_weight").innerText),n.total_price=parseFloat((n.veg_price*n.veg_weight).toFixed(2)),N(n),s())}}),r.util.on("#goodsInfo","shown",t=>{r.util.attr(r.util.$$("#goodsInfo"),"isOpen",1)}),r.util.on("#goodsInfo","beforehide",t=>{r.util.attr(r.util.$$("#goodsInfo"),"isOpen",0)});function e(t,n){document.querySelector("#showWin").innerText=t,n?(document.querySelector("#price-editer").setAttribute("valueType","price"),document.querySelector("#deciBtn").style.display="block"):(document.querySelector("#price-editer").setAttribute("valueType","count"),document.querySelector("#deciBtn").style.display="none"),document.querySelector("#showWin").setAttribute("deci",0),r.modal("#price-editer",{stack:!0}).show()}r.util.on("#totalBtn","click",t=>{e("",!0)}),r.util.on(".numBtn","click",t=>{const n=t.currentTarget.innerText;let i=document.querySelector("#showWin").innerText;const c=document.querySelector("#showWin").getAttribute("deci");n=="."?c!=1&&(document.querySelector("#showWin").setAttribute("deci",1),i?i+=".":i="0."):i+=n,/^(0|[1-9][0-9]*)+\.?\d{0,2}$/.test(i)&&(document.querySelector("#showWin").innerText=i)}),r.util.on("#backspace","click",t=>{let n=document.querySelector("#showWin").innerText;n&&n.length>0&&(n.charAt(n.length-1)=="."&&document.querySelector("#showWin").setAttribute("deci",0),n=n.substring(0,n.length-1),document.querySelector("#showWin").innerText=n)}),r.util.on("#price-editer #okBtn","click",t=>{let n=m();if(n){const i=document.querySelector("#showWin").innerText;document.querySelector("#price-editer").getAttribute("valueType")=="price"?(document.querySelector("#veg_price").innerText=i,n.veg_price=parseFloat(i),n.veg_weight=parseInt(document.querySelector("#count").value)):(document.querySelector("#count").value=i,n.veg_weight=parseInt(i)),n.total_price=(n.veg_price*n.veg_weight).toFixed(2),document.querySelector("#total_price").innerText=n.total_price,h(n)}});function o(t){return/^(0|[1-9][0-9]*)$/.test(t)}r.util.on("#plus","click",()=>{const t=parseInt(document.querySelector("#count").value)+1;if(o(t)){document.querySelector("#count").value=t;const n=document.querySelector("#veg_price").innerText;document.querySelector("#total_price").innerText=(parseFloat(n)*t).toFixed(2)}}),r.util.on("#minus","click",()=>{const t=parseInt(document.querySelector("#count").value)-1;if(o(t)){document.querySelector("#count").value=t;const n=document.querySelector("#veg_price").innerText;document.querySelector("#total_price").innerText=(parseFloat(n)*t).toFixed(2)}}),r.util.on("#count","click",t=>{e("")}),r.util.ajax("vegetables-type.json",{responseType:"json"}).then(({response:{status:t,data:n}})=>{t==1?(n.forEach(i=>{r.util.append("#vegList",`<div >
                <div class="uk-card uk-card-default" id="vid_${i.id}" data-info='${JSON.stringify(i)}'>
                    <div class="uk-card-media-top">
                        <img data-src="/images/g${i.id}.png" width="150" height="150" alt="" uk-img>
                    </div>
                    <div class="uk-card-body">
                        <p>${i.veg_name}</p>
                        <p>${i.type==2?i.veg_price+"\u5143":i.veg_price+"\u5143/kg"}</p>
                    </div>
                </div>
            </div>`)}),r.util.on(".riht-wrap .uk-card","click",i=>{let c=JSON.parse(r.util.data(i.currentTarget,"info"));c&&(c.type==2?(document.querySelector("#weightWrap").style.display="none",document.querySelector("#numWrap").style.display="block",r.util.attr(r.util.$("#goodsIcon"),"src",`/images/g${c.id}.png`),r.util.html("#veg_name",c.veg_name),r.util.html("#veg_price",document.createTextNode(c.veg_price)),r.util.html("#total_price",document.createTextNode(c.veg_price)),r.modal("#goodsInfo").show()):(document.querySelector("#weightWrap").style.display="block",document.querySelector("#numWrap").style.display="none",c.veg_weight=W(),c.total_price=(c.veg_price*c.veg_weight).toFixed(2),r.util.attr(r.util.$("#goodsIcon"),"src",`/images/g${c.id}.png`),r.util.html("#veg_name",c.veg_name),r.util.html("#veg_price",document.createTextNode(c.veg_price)),r.util.html("#veg_weight",document.createTextNode(c.veg_weight)),r.util.html("#total_price",document.createTextNode(c.total_price)),r.modal("#goodsInfo").show()),h(c))})):r.modal.dialog('<p class="uk-modal-body">\u83B7\u53D6\u83DC\u54C1\u6570\u636E\u5931\u8D25</p>')}).catch(t=>{console.error(t)})}};r.util.ready(function(){E.init(),F.init(),r.util.on("#saveBtn","click",()=>{}),r.util.on("#clearAllBtn","click",()=>{A()})});
